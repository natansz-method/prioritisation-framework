/* version: 1728901314719 */
!function(){"use strict";!function(){const e="q",t="cmp-saas-suggestions",n="cmp-saas__search-input",a=`.cmp-saas__form #${t}`,s="cmp-saas__suggestion-element",o=`${s}--active`,c="__saas__suggestions__",r="__saas__queryString__",i=function(e=[c,r]){e?.forEach((function(e){return sessionStorage.removeItem(e)}))},u=function({storageKey:e,defaultValue:t,parse:n=!0}){return n?JSON.parse(sessionStorage.getItem(e)||t):sessionStorage.getItem(e)||t},l=function({storageKey:e,data:t,stringify:n=!0}){sessionStorage.setItem(e,n?JSON.stringify(t):t)},d=function({searchButtonText:e}){const t=document.createElement("button");return t.classList.add("cmp-saas__button"),t.type="submit",t.textContent=e,t},m="saas-search-result-item-click",h="saas-autosuggest-select",f="saas-search-submit",g=function({name:e,data:t}){return new CustomEvent(e,{bubbles:!0,detail:t})},p=async function(t,n,a,s,o){try{const c=function(t,n,a,s,o){const c=new URL(`${window.location.origin}${t}`);return c.searchParams.set(e,n),a&&c.searchParams.set("page",a.toString()),s&&o&&Object.keys(o).forEach((function(e){const t=o[e].toString();c.searchParams.append(s,`${e}:${t}`)})),c.toString()}(t,n,a,s,o),r=await fetch(c);return await r.json()}catch{return null}},w=function(t){const n=new URL(window.location.href),a=new URLSearchParams(n.search);a.set(e,t),window.history.replaceState({},"",`${window.location.pathname}?${a.toString()}${window.location.hash}`)},_=function(t,n){const a=new URL(window.location.href);a.searchParams.set(e,t);const s=document.createElement("div");s.classList.add("cmp-saas__autosuggest");const o=document.createElement("a");return o.innerText=`${n} ${t}`,o.href=a.toString(),s.appendChild(o),s.addEventListener("click",(function(e){e.target?.dispatchEvent(g({name:t,data:{autoSuggestText:n}}))})),s},y=async function(t,n,a,s,o,c,r){if("true"===n.dataset.loading)return;const i=n,u=s&&s.length>0;u&&(i.dataset.loading="true");const l=n.value;if(a&&a!==window.location.pathname){const t=new URL(window.location.href),n=new URLSearchParams(t.search);n.set(e,l),window.location.href=`${a}?${n.toString()}`}w(l),function(e){const t=e.querySelector(".cmp-saas__autosuggest");t?.remove()}(c);const d=u?await Promise.all(s.map((async function(e,t){return{...await p(e.url,l),tabId:e.tabId||e.title,title:e.title,index:t}}))).finally((function(){i.dataset.loading="false"})):null,m=t.parentElement,h=d?.some((function(e){return e.resultsTotal})),f=d?.[0]?.suggestion,g=u&&!h,y=g&&f,v=g&&m;if(u&&h&&m?.querySelectorAll(".cmp-saas__not-found")?.forEach((function(e){return e.remove()})),y){const e=_(f.text,o);m?.append(e)}const E=m?.querySelector(".cmp-saas__not-found");if(v&&!E){const e=document.createElement("div");e.classList.add("cmp-saas__not-found"),e.innerText=r,m.appendChild(e)}},v=function(){const e=document.createElement("form");return e.classList.add("cmp-saas__form"),e};const E=function(e,t=500){var n=this;let a;return function(...s){clearTimeout(a),a=setTimeout((function(){e.apply(n,s)}),t)}},L=function(e){return e.replace(/\s+/g," ").trim()},S=async function(t,n){try{const a=function(t,n){const a=new URL(`${window.location.origin}${t}`);return a.searchParams.set(e,n),a.toString()}(t,n),s=await fetch(a);return(await s.json()).filter((function(e){return e.length}))}catch{return null}},T=function(e,t){e.setAttribute("saasCurrentFocusSuggestion",t.toString())},b=function(e){const t=e.querySelector(a);t&&t.remove()},x=function({results:e,regexp:t,query:n,searchInput:a,searchContainer:o,suggestionDropdown:c}){if(!n)return;b(o);const r=document.getElementsByClassName("cmp-saas__button")?.[0];e.forEach((function(u){const l=L(u).replace(t,`<span class="cmp-saas__suggestion-element--matched-query">${n}</span>`),d=document.createElement("div");d.innerHTML=l,d.classList.add(s),d.addEventListener("click",(function(t){const s=a;i(),b(o),s.value=u,t.target?.dispatchEvent(g({name:h,data:{query:n,results:e.length,term:d.textContent}})),r?r.click():function(){const e=document.querySelector(".cmp-saas__form");e?.submit()}()})),c.appendChild(d)})),a.after(c)},C=function(e){const t=L(e);return{cleanedQuery:t,regexp:new RegExp(t,"gi")}},$=function({id:d,searchFieldPlaceholderText:m,autocompleteUrl:h,autocompleteTriggerThreshold:f,autoSuggestionDebounceTime:g=500,searchContainer:p}){const w=document.createElement("input");w.classList.add(n),w.name=e,w.placeholder=m,w.id=d,w.autocomplete="off",T(w,-1);const _=function(e){return E((async function(e,n,s,o,u){if(T(o,-1),(!n?.length||n.length<s)&&(b(u),i()),n.length>=s){const{cleanedQuery:s,regexp:d}=C(n),m=await S(e,s),h=u.querySelector(a);let f=null;l({storageKey:r,data:n,stringify:!1}),h?f=h:(f=document.createElement("div"),f.id=t),i([c]),f.innerHTML="",m?.length>0&&(l({storageKey:c,data:m}),x({results:m,regexp:d,query:n,searchInput:o,searchContainer:u,suggestionDropdown:f}))}}),e)}(g);return w.addEventListener("focus",(function(){const e=u({storageKey:r,defaultValue:"",parse:!1}),n=u({storageKey:c,defaultValue:"[]"}),{regexp:a}=C(e),s=document.createElement("div");s.id=t,x({results:n,regexp:a,query:e,searchInput:w,searchContainer:p,suggestionDropdown:s})})),w.addEventListener("input",(function(e){const t=e?.target?.value,n=document.querySelector(".cmp-saas__search-clear-button"),a=t.length>=f?"remove":"add";n?.classList[a]("cmp-saas__search-clear-button--hide"),_(h,t,f,w,p)?.catch((function(e){throw e}))})),w.addEventListener("keydown",(function(e){const n=p.querySelectorAll(`#${t} .${s}`);if(n?.length<=0)return;const a=n.length-1,c=w.getAttribute("saasCurrentFocusSuggestion")??"-1";const r=parseInt(c,10),i=n[r];if("ArrowDown"===e.key&&r<a){const e=r+1,t=n[e];i?.classList.remove(o),t?.classList.add(o),T(w,e)}if("ArrowUp"===e.key&&r>-1){const e=r-1,t=n[e];i?.classList.remove(o),t?.classList.add(o),T(w,e)}"Enter"===e.key&&i&&(T(w,-1),i.click())})),document.addEventListener("click",(function(e){e.target.classList.contains(n)||b(p)})),w},q=function(e){if(!e)return null;const t=e.dataset.searchConfig||"{}",n=JSON.parse(t),a=function(e){const{id:t,searchFieldPlaceholderText:n,searchUrl:a}=e;return"string"==typeof t&&Boolean(t)&&"string"==typeof n&&Boolean(n)&&(!a||"string"==typeof a)}(n);return a?n:null},U=async function(t,n){const a=q(t);if(!a)return;const{trackingUrl:s}=a,{autoSuggestionDebounceTime:o=500}=n||{};s&&document.addEventListener(m,(function(e){const t=new Headers;t.append("Content-Type","application/x-www-form-urlencoded");const n=e.detail.url;fetch(s,{method:"POST",headers:t,body:`trackedUrl=${n}`}).catch((function(e){console.error(`Error while tracking search result item with url: ${n}.`,e)}))}));const{id:c,searchFieldPlaceholderText:r,searchButtonText:u,searchUrl:l,searchTabs:h,autocompleteUrl:p,autocompleteTriggerThreshold:w,autoSuggestText:_,noResultsText:E}=a,L=document.createElement("div");L.classList.add("cmp-saas");const S=v(),T=function(){const e=document.createElement("span");return e.classList.add("cmp-saas__search-clear-button"),e.addEventListener("click",(function(){e.classList.add("cmp-saas__search-clear-button--hide");const t=document.getElementsByClassName("cmp-saas__search-input")?.[0];if(t){t.value="",t.focus(),i();const e=document.querySelectorAll("#cmp-saas-suggestions");e.length>0&&e.forEach((function(e){return e.remove()}))}})),e}(),b=document.createElement("div");b.classList.add("cmp-saas__search-input-wrapper");const x=$({id:c,searchFieldPlaceholderText:r,autocompleteUrl:p,autocompleteTriggerThreshold:w,autoSuggestionDebounceTime:o,searchContainer:L}),C=u?d({searchButtonText:u}):null;!function(e,t,n,a,s,o,c){e.addEventListener("submit",(function(r){return r.preventDefault(),r.target?.dispatchEvent(g({name:f,data:{query:t.value}})),y(e,t,n,a,s,o,c)}))}(S,x,l,h,_,L,E),b.appendChild(x),S.appendChild(b),C&&S.appendChild(C),T?.classList.add("cmp-saas__search-clear-button--hide"),b.appendChild(T);const U=t.parentElement;U?.replaceChild(L,t),L.appendChild(S);const k=new URL(window.location.href),P=new URLSearchParams(k.search).get(e);P&&(x.value=P,T?.classList.remove("cmp-saas__search-clear-button--hide"),await y(S,x,l,h,_,L,E))};(function(){window.addEventListener("load",(function(){const e=function(e="search"){return document.querySelectorAll(e)}();i(),e&&e?.forEach((function(e){U(e)}))}))})()}()}();
//# sourceMappingURL=/etc.clientlibs/pg/clientlibs/clientlib-saas/resources/saas.js.map